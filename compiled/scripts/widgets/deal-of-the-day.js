define(["modules/jquery-mozu","shim!vendor/underscore>_","modules/api","modules/backbone-mozu","modules/models-product"],function(e,t,o,d,n){e(function(){e("[data-mz-deal-of-the-day]").each(function(t,a){a=e(a);var u,r,l=a.data("mzDealOfTheDay");u=o.get("search",{filter:"discountId eq "+l.discountId,pageSize:"product"===l.displayStyle?1:20}),r=d.MozuView.extend({templateName:"modules/product/product-list",getRenderContext:function(){var e=d.MozuView.prototype.getRenderContext.apply(this,arguments);return e.dealOfTheDay=l,e}}),u.then(function(e){var t,o=new n.ProductCollection(e.data);if(0===o.attributes.totalCount)throw"Deal of the Day: there are no products to show for the selected discount.";t=new r({model:o,el:a}),t.render()})})})});